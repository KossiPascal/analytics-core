"use strict";(self.webpackChunkwebapp=self.webpackChunkwebapp||[]).push([["src_app_modules_managements-view_managements_module_ts"],{3111:(O,h,a)=>{a.d(h,{d:()=>M});var E=a(3308),d=a(6104),r=a(6769),m=a(6098),R=a(8394),t=a(8175),T=a(6167),I=a(4796),A=a(4224),g=a(960);let M=(()=>{class u{constructor(c,_,e,o,s,n,i){this.titleService=c,this.constants=_,this.router=e,this.userContext=o,this.auth=s,this.indexdb=n,this.error=i,this.destroy$=new d.B}canActivate(c,_){var e=this;return(0,E.A)(function*(){const o=yield e.userContext.currentUser();if(!e.userContext.isLoggedIn()||!o)return e.auth.logout(),!1;const s=c.data?.href;if(o.mustChangeDefaultPassword&&!o.hasChangedDefaultPassword&&"auths/change-default-password"!=s)return location.href="auths/change-default-password",!1;const n=c.data?.access??[],i=c.data?.title||e.constants.APP_TITLE,l=new Set;for(const p of o.routes??[])for(const S of p.authorizations??[])l.add(S);return!0===o.role?.isSuperUser||e.hasAnyMatch(l,n)?(e.titleService.setTitle(i),!0):(e.error.navigateTo("401"),!1)})()}hasAnyMatch(c,_){return _.some(e=>c.has(e))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static{this.\u0275fac=function(_){return new(_||u)(r.KVO(m.hE),r.KVO(R.D),r.KVO(t.t),r.KVO(T.i),r.KVO(I.u),r.KVO(A.T),r.KVO(g.Z))}}static{this.\u0275prov=r.jDH({token:u,factory:u.\u0275fac,providedIn:"root"})}}return u})()},6462:(O,h,a)=>{a.r(h),a.d(h,{ManagementsModule:()=>_});var E=a(4765),d=a(8832),r=a(6651),m=a(3111),R=a(3691),t=a(6769),T=a(3366);function I(e,o){if(1&e&&(t.qex(0),t.EFF(1),t.bVm()),2&e){const s=o.ngIf;t.R7$(),t.SpI(" ","ok"==s?"\u2713":"no"==s?"\xd7":""," ")}}function A(e,o){if(1&e){const s=t.RV6();t.j41(0,"tr")(1,"td",6),t.EFF(2),t.k0s(),t.j41(3,"td",6),t.DNE(4,I,2,1,"ng-container",1),t.k0s(),t.j41(5,"td",6)(6,"button",7),t.bIt("click",function(){const i=t.eBV(s).$implicit,l=t.XpG(2);return t.Njj(l.runOneMigrationAvailable(i.name))}),t.EFF(7,"Exc\xe9cuter"),t.k0s()()()}if(2&e){const s=o.$implicit,n=t.XpG(2);t.R7$(2),t.JRh(s.name),t.R7$(2),t.Y8G("ngIf",n.isSuccess(s.name))}}function g(e,o){if(1&e&&(t.qex(0),t.j41(1,"div",2)(2,"table",3)(3,"thead")(4,"tr")(5,"th",4),t.EFF(6,"Name"),t.k0s(),t.j41(7,"th",4),t.EFF(8,"Resultat"),t.k0s(),t.j41(9,"th",4),t.EFF(10,"Actions"),t.k0s()()(),t.j41(11,"tbody"),t.DNE(12,A,8,2,"tr",5),t.k0s()()(),t.bVm()),2&e){const s=o.ngIf;t.R7$(12),t.Y8G("ngForOf",s)}}let M=(()=>{class e{constructor(s){this.api=s,this.CHANGE_STATE=null,this.SELECTED_MIGRATIONS_NAME=[]}ngOnInit(){this.getAllMigrationsPathList()}isSuccess(s){if(this.MIGRATIONS_LIST&&this.RUNED_MIGRATIONS_LIST&&this.SELECTED_MIGRATIONS_NAME.includes(s))return this.RUNED_MIGRATIONS_LIST.some(n=>n.name==s)?"ok":"no"}hasCommonMigrations(s,n){const i=new Set(s.map(l=>l.name));return n.some(l=>i.has(l.name))}getAllMigrationsPathList(){this.GET_ERROR=null,this.api.getAllMigrationsPathList().subscribe({next:s=>{200==s.status?this.MIGRATIONS_LIST=s.data:this.GET_ERROR=s.data},error:s=>{this.GET_ERROR=s},complete:()=>{}})}runAllMigrationsAvailable(){this.api.runAllMigrationsAvailable().subscribe({next:s=>{200==s.status?(this.RUNED_MIGRATIONS_LIST=s.data,this.SELECTED_MIGRATIONS_NAME=[...this.SELECTED_MIGRATIONS_NAME,...this.RUNED_MIGRATIONS_LIST.map(n=>n.name)]):this.RUNED_ERROR=s.data},error:s=>{this.RUNED_ERROR=s},complete:()=>{}})}getOneMigrationsPath(){this.api.getOneMigrationsPath("migrationName").subscribe({next:s=>{200==s.status?this.MIGRATIONS_LIST=[s.data]:this.GET_ERROR=s.data},error:s=>{this.GET_ERROR=s},complete:()=>{}})}runOneMigrationAvailable(s){this.api.runOneMigrationAvailable(s).subscribe({next:n=>{200==n.status?(this.RUNED_MIGRATIONS_LIST=[...this.RUNED_MIGRATIONS_LIST??[],n.data],this.SELECTED_MIGRATIONS_NAME=[...this.SELECTED_MIGRATIONS_NAME,...this.RUNED_MIGRATIONS_LIST.map(i=>i.name)]):this.RUNED_ERROR=n.data},error:n=>{this.RUNED_ERROR=n},complete:()=>{}})}static{this.\u0275fac=function(n){return new(n||e)(t.rXU(T.G))}}static{this.\u0275cmp=t.VBU({type:e,selectors:[["rebuild-sql-views"]],standalone:!1,decls:8,vars:1,consts:[[2,"font-size","20px",3,"click"],[4,"ngIf"],[1,"table-responsive"],[1,"table","table-bordered","table-hover"],["scope","col"],[4,"ngFor","ngForOf"],[1,""],[3,"click"]],template:function(n,i){1&n&&(t.j41(0,"h2"),t.EFF(1,"\u{1f4c8} Gestions des vues SQL et migrations"),t.k0s(),t.nrm(2,"br"),t.j41(3,"button",0),t.bIt("click",function(){return i.runAllMigrationsAvailable()}),t.EFF(4,"Exc\xe9cuter toutes les migrations"),t.k0s(),t.nrm(5,"br")(6,"br"),t.DNE(7,g,13,1,"ng-container",1)),2&n&&(t.R7$(7),t.Y8G("ngIf",i.MIGRATIONS_LIST))},dependencies:[E.G,E.I],styles:["button[_ngcontent-%COMP%]{padding:5px 10px;background:#88ad88;border-radius:5px}"]})}}return e})();const f=[{path:"",component:(()=>{class e{constructor(){this.CHANGE_STATE=null,(0,R.Ey)()}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=t.VBU({type:e,selectors:[["app-managements-data"]],standalone:!1,decls:6,vars:1,consts:[[1,"nav-tabs"],["data-target","SYNC_ORG_UNITS",1,"tab-link","active"],[1,"tab-content"],["id","SYNC_ORG_UNITS",1,"view","active"],[3,"CHANGE_STATE"]],template:function(n,i){1&n&&(t.j41(0,"div",0)(1,"button",1),t.EFF(2,"Rebuild Sql Views"),t.k0s()(),t.j41(3,"div",2)(4,"div",3),t.nrm(5,"rebuild-sql-views",4),t.k0s()()),2&n&&(t.R7$(5),t.Y8G("CHANGE_STATE",i.CHANGE_STATE))},dependencies:[M],encapsulation:2})}}return e})(),canActivate:[m.d],data:{href:"manages",title:"Sync Steply",access:["can_manage_data"]}}];let c=(()=>{class e{static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275mod=t.$C({type:e})}static{this.\u0275inj=t.G2t({imports:[r.m.forChild(f),r.m]})}}return e})(),_=(()=>{class e{static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275mod=t.$C({type:e})}static{this.\u0275inj=t.G2t({imports:[E.D,d.X1,c]})}}return e})()}}]);