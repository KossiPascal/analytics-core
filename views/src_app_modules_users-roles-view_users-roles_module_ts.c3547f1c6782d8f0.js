"use strict";(self.webpackChunkwebapp=self.webpackChunkwebapp||[]).push([["src_app_modules_users-roles-view_users-roles_module_ts"],{3111:(L,k,u)=>{u.d(k,{d:()=>C});var _=u(3308),l=u(6104),g=u(6769),R=u(6098),b=u(8394),e=u(8175),v=u(6167),S=u(4796);let C=(()=>{class f{constructor(E,h,p,U,G){this.titleService=E,this.constants=h,this.router=p,this.userContext=U,this.authService=G,this.destroy$=new l.B}canActivate(E,h){var p=this;return(0,_.A)(function*(){const U=yield p.userContext.currentUser();if(!p.userContext.isLoggedIn()||!U)return p.authService.logout(),!1;const G=E.data?.access??[],D=E.data?.title||p.constants.APP_TITLE,O=new Set;for(const j of U.routes??[])for(const w of j.authorizations??[])O.add(w);return!0===U.role?.isSuperUser||p.hasAnyMatch(O,G)?(p.titleService.setTitle(D),!0):(p.router.navigate(["/errors/unauthorized"]),!1)})()}hasAnyMatch(E,h){return h.some(p=>E.has(p))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static{this.\u0275fac=function(h){return new(h||f)(g.KVO(R.hE),g.KVO(b.D),g.KVO(e.t),g.KVO(v.i),g.KVO(S.u))}}static{this.\u0275prov=g.jDH({token:f,factory:f.\u0275fac,providedIn:"root"})}}return f})()},8037:(L,k,u)=>{u.r(k),u.d(k,{UsersRolesModule:()=>Te});var _=u(4765),l=u(8832),g=u(6651),R=u(3308),b=u(3691),e=u(6769),v=u(6167),S=u(8394),C=u(3366),f=u(5455),F=u(3598);let E=(()=>{class r{transform(t){return t.split("_").map(i=>i.charAt(0).toUpperCase()+i.slice(1)).join(" ")}static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275pipe=e.EJ8({name:"formatRole",type:r,pure:!0,standalone:!1})}static{this.\u0275prov=e.jDH({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();const h=r=>({show:r});function p(r,n){if(1&r&&(e.j41(0,"tr")(1,"td")(2,"span",4),e.EFF(3),e.k0s()(),e.j41(4,"td"),e.nrm(5,"input",5),e.k0s()()),2&r){const t=n.$implicit,i=e.XpG(3);e.R7$(2),e.HbH(i.containsRole(t.id)?"action-checked":"action-unchecked"),e.R7$(),e.SpI(" ",i.titleCase(t.name)," "),e.R7$(2),e.Y8G("checked",i.containsRole(t.id))("disabled",!0)}}function U(r,n){if(1&r&&(e.j41(0,"table"),e.DNE(1,p,6,6,"tr",3),e.k0s()),2&r){const t=e.XpG(2);e.R7$(),e.Y8G("ngForOf",t.ROLES)}}function G(r,n){if(1&r&&(e.j41(0,"div")(1,"kossi-modal-layout",1),e.nrm(2,"img",2),e.DNE(3,U,2,1,"table",0),e.k0s()()),2&r){const t=e.XpG();e.R7$(),e.Y8G("id","show-roles-modal")("modalActionColor","dark-back")("showCloseButton",!0)("modalTitle","R\xf4les")("cancelBtnName","Annuler")("submitBtnName","Oui Supprimer")("showBottomElements",!1),e.R7$(),e.FS9("src",t.APP_LOGO,e.B4B),e.R7$(),e.Y8G("ngIf",t.ROLES)}}function D(r,n){if(1&r&&(e.j41(0,"div",8),e.EFF(1),e.k0s()),2&r){const t=e.XpG(2);e.R7$(),e.JRh(t.message)}}function O(r,n){if(1&r){const t=e.RV6();e.j41(0,"div")(1,"kossi-modal-layout",6),e.bIt("onSubmit",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.delete())}),e.j41(2,"div"),e.EFF(3,"\xcates-vous s\xfbr de vouloir supprimer cet utilisateur ?"),e.k0s(),e.j41(4,"div"),e.EFF(5,"Cette action est ir\xe9versible! \xcates vous s\xfbr de proc\xe9der \xe0 la suppression ?"),e.k0s(),e.DNE(6,D,2,1,"div",7),e.k0s()()}if(2&r){const t=e.XpG();e.R7$(),e.Y8G("id","delete-confirm-modal")("modalActionColor","danger-back")("showCloseButton",!0)("modalTitle","Suppression de: "+(t.SELECTED_USER?t.SELECTED_USER.fullname:"l'utilisateur!"))("cancelBtnName","Annuler")("submitBtnName","Oui Supprimer")("showBottomElements",!0)("showCancelButton",!0)("reloadApp",!1)("closeAfterSubmited",!1)("processing",t.isProcessing),e.R7$(5),e.Y8G("ngIf",t.message&&""!=t.message)}}function I(r,n){if(1&r&&(e.j41(0,"span",36),e.EFF(1),e.k0s()),2&r){const t=e.XpG(2);e.R7$(),e.JRh(t.message)}}function j(r,n){if(1&r){const t=e.RV6();e.j41(0,"div",37)(1,"input",38),e.bIt("change",function(){const s=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.addOrRemoveRole(s.id))}),e.k0s(),e.j41(2,"label",39),e.EFF(3),e.nI1(4,"formatRole"),e.k0s()()}if(2&r){const t=n.$implicit,i=e.XpG(2);e.R7$(),e.Mz_("id","add-remove-roles-",t.id,""),e.Y8G("checked",i.containsRole(t.id)),e.R7$(),e.Mz_("for","add-remove-roles-",t.id,""),e.R7$(),e.JRh(e.bMT(4,6,t.name))}}function w(r,n){if(1&r){const t=e.RV6();e.j41(0,"div",46)(1,"aside",41)(2,"input",43),e.bIt("change",function(){const s=e.eBV(t).$implicit,o=e.XpG(8);return e.Njj(o.selectVillageSecteurs(s))}),e.k0s(),e.j41(3,"label",44),e.EFF(4),e.k0s()()()}if(2&r){const t=n.$implicit,i=e.XpG().$implicit,s=e.XpG(7);e.Y8G("ngClass",e.eq3(7,h,s.isListOpenToShow("district-"+i.id))),e.R7$(2),e.Mz_("id","village_secteur-",t.id,""),e.Y8G("checked",s.containsOrgUnits("villageSecteurs",t.id)),e.R7$(),e.Mz_("for","village_secteur-",t.id,""),e.R7$(),e.JRh(t.name)}}function N(r,n){if(1&r){const t=e.RV6();e.j41(0,"div",46)(1,"aside",41)(2,"button",42),e.bIt("click",function(){const s=e.eBV(t).$implicit,o=e.XpG(7);return e.Njj(o.toggleList("district-"+s.id))}),e.j41(3,"span"),e.EFF(4),e.k0s()(),e.j41(5,"input",43),e.bIt("change",function(){const s=e.eBV(t).$implicit,o=e.XpG(7);return e.Njj(o.selectDistrictQuartiers(s))}),e.k0s(),e.j41(6,"label",44),e.EFF(7),e.k0s()(),e.DNE(8,w,5,9,"div",45),e.k0s()}if(2&r){const t=n.$implicit,i=e.XpG().$implicit,s=e.XpG(6);e.Y8G("ngClass",e.eq3(9,h,s.isListOpenToShow("hospital-"+i.id))),e.R7$(4),e.JRh(s.isListOpenToShow("district-"+t.id)?"-":"+"),e.R7$(),e.Mz_("id","district-",t.id,""),e.Y8G("checked",s.containsOrgUnits("districtQuartiers",t.id)),e.R7$(),e.Mz_("for","district-",t.id,""),e.R7$(),e.JRh(t.name),e.R7$(),e.Y8G("ngForOf",s.generateVillageSecteurs(t.id))}}function y(r,n){if(1&r){const t=e.RV6();e.j41(0,"div",46)(1,"aside",41)(2,"button",42),e.bIt("click",function(){const s=e.eBV(t).$implicit,o=e.XpG(6);return e.Njj(o.toggleList("hospital-"+s.id))}),e.j41(3,"span"),e.EFF(4),e.k0s()(),e.j41(5,"input",43),e.bIt("change",function(){const s=e.eBV(t).$implicit,o=e.XpG(6);return e.Njj(o.selectHospitals(s))}),e.k0s(),e.j41(6,"label",44),e.EFF(7),e.k0s()(),e.DNE(8,N,9,11,"div",45),e.k0s()}if(2&r){const t=n.$implicit,i=e.XpG().$implicit,s=e.XpG(5);e.Y8G("ngClass",e.eq3(9,h,s.isListOpenToShow("commune-"+i.id))),e.R7$(4),e.JRh(s.isListOpenToShow("hospital-"+t.id)?"-":"+"),e.R7$(),e.Mz_("id","hospital-",t.id,""),e.Y8G("checked",s.containsOrgUnits("hospitals",t.id)),e.R7$(),e.Mz_("for","hospital-",t.id,""),e.R7$(),e.JRh(t.name),e.R7$(),e.Y8G("ngForOf",s.generateDistrictQuartiers(t.id))}}function P(r,n){if(1&r){const t=e.RV6();e.j41(0,"div",46)(1,"aside",41)(2,"button",42),e.bIt("click",function(){const s=e.eBV(t).$implicit,o=e.XpG(5);return e.Njj(o.toggleList("commune-"+s.id))}),e.j41(3,"span"),e.EFF(4),e.k0s()(),e.j41(5,"input",43),e.bIt("change",function(){const s=e.eBV(t).$implicit,o=e.XpG(5);return e.Njj(o.selectCommunes(s))}),e.k0s(),e.j41(6,"label",44),e.EFF(7),e.k0s()(),e.DNE(8,y,9,11,"div",45),e.k0s()}if(2&r){const t=n.$implicit,i=e.XpG().$implicit,s=e.XpG(4);e.Y8G("ngClass",e.eq3(9,h,s.isListOpenToShow("prefecture-"+i.id))),e.R7$(4),e.JRh(s.isListOpenToShow("commune-"+t.id)?"-":"+"),e.R7$(),e.Mz_("id","commune-",t.id,""),e.Y8G("checked",s.containsOrgUnits("communes",t.id)),e.R7$(),e.Mz_("for","commune-",t.id,""),e.R7$(),e.JRh(t.name),e.R7$(),e.Y8G("ngForOf",s.generateHospitals(t.id))}}function B(r,n){if(1&r){const t=e.RV6();e.j41(0,"div",46)(1,"aside",41)(2,"button",42),e.bIt("click",function(){const s=e.eBV(t).$implicit,o=e.XpG(4);return e.Njj(o.toggleList("prefecture-"+s.id))}),e.j41(3,"span"),e.EFF(4),e.k0s()(),e.j41(5,"input",43),e.bIt("change",function(){const s=e.eBV(t).$implicit,o=e.XpG(4);return e.Njj(o.selectPrefectures(s))}),e.k0s(),e.j41(6,"label",44),e.EFF(7),e.k0s()(),e.DNE(8,P,9,11,"div",45),e.k0s()}if(2&r){const t=n.$implicit,i=e.XpG().$implicit,s=e.XpG(3);e.Y8G("ngClass",e.eq3(9,h,s.isListOpenToShow("region-"+i.id))),e.R7$(4),e.JRh(s.isListOpenToShow("prefecture-"+t.id)?"-":"+"),e.R7$(),e.Mz_("id","prefecture-",t.id,""),e.Y8G("checked",s.containsOrgUnits("prefectures",t.id)),e.R7$(),e.Mz_("for","prefecture-",t.id,""),e.R7$(),e.JRh(t.name),e.R7$(),e.Y8G("ngForOf",s.generateCommunes(t.id))}}function X(r,n){if(1&r){const t=e.RV6();e.j41(0,"div",46)(1,"aside",41)(2,"button",42),e.bIt("click",function(){const s=e.eBV(t).$implicit,o=e.XpG(3);return e.Njj(o.toggleList("region-"+s.id))}),e.j41(3,"span"),e.EFF(4),e.k0s()(),e.j41(5,"input",43),e.bIt("change",function(){const s=e.eBV(t).$implicit,o=e.XpG(3);return e.Njj(o.selectRegions(s))}),e.k0s(),e.j41(6,"label",44),e.EFF(7),e.k0s()(),e.DNE(8,B,9,11,"div",45),e.k0s()}if(2&r){const t=n.$implicit,i=e.XpG().$implicit,s=e.XpG(2);e.Y8G("ngClass",e.eq3(9,h,s.isListOpenToShow("country-"+i.id))),e.R7$(4),e.JRh(s.isListOpenToShow("region-"+t.id)?"-":"+"),e.R7$(),e.Mz_("id","region-",t.id,""),e.Y8G("checked",s.containsOrgUnits("regions",t.id)),e.R7$(),e.Mz_("for","region-",t.id,""),e.R7$(),e.JRh(t.name),e.R7$(),e.Y8G("ngForOf",s.generatePrefectures(t.id))}}function M(r,n){if(1&r){const t=e.RV6();e.j41(0,"div",40)(1,"aside",41)(2,"button",42),e.bIt("click",function(){const s=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.toggleList("country-"+s.id))}),e.j41(3,"span"),e.EFF(4),e.k0s()(),e.j41(5,"input",43),e.bIt("change",function(){const s=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.selectCountries(s))}),e.k0s(),e.j41(6,"label",44),e.EFF(7),e.k0s()(),e.DNE(8,X,9,11,"div",45),e.k0s()}if(2&r){const t=n.$implicit,i=e.XpG(2);e.R7$(4),e.JRh(i.isListOpenToShow("country-"+t.id)?"-":"+"),e.R7$(),e.Y8G("checked",i.containsOrgUnits("countries",t.id))("id","country-"+t.id),e.R7$(),e.Mz_("for","country-",t.id,""),e.R7$(),e.JRh(t.name),e.R7$(),e.Y8G("ngForOf",i.generateRegions(t.id))}}function z(r,n){if(1&r){const t=e.RV6();e.j41(0,"div")(1,"kossi-modal-layout",9),e.bIt("onSubmit",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.registerOrUpdate())}),e.j41(2,"div",10),e.DNE(3,I,2,1,"span",11),e.k0s(),e.j41(4,"div",12)(5,"form",13)(6,"div",14),e.EFF(7,"Informations"),e.k0s(),e.j41(8,"div",15)(9,"div",16)(10,"span",17),e.nrm(11,"i",18),e.k0s(),e.nrm(12,"input",19),e.k0s(),e.j41(13,"div",16)(14,"span",17),e.nrm(15,"span",18),e.k0s(),e.nrm(16,"input",20),e.k0s()(),e.j41(17,"div",15)(18,"div",16)(19,"span",17),e.nrm(20,"i",21),e.k0s(),e.nrm(21,"input",22),e.j41(22,"i",23),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.togglePasswordVisibility())}),e.k0s()(),e.j41(23,"div",16)(24,"span",17),e.nrm(25,"i",21),e.k0s(),e.nrm(26,"input",24),e.j41(27,"i",23),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.togglePasswordVisibility())}),e.k0s()(),e.j41(28,"span",25),e.EFF(29,"Minimum 8 caract\xe8res avec chiffres et symboles"),e.k0s()(),e.j41(30,"div",15)(31,"div",16)(32,"span",17),e.nrm(33,"i",26),e.k0s(),e.nrm(34,"input",27),e.k0s(),e.j41(35,"div",28),e.nrm(36,"input",29),e.j41(37,"label",30),e.EFF(38,"Activer"),e.k0s()()(),e.nrm(39,"br"),e.j41(40,"div",31),e.EFF(41,"R\xf4les d'action"),e.k0s(),e.j41(42,"div",32)(43,"div",15),e.DNE(44,j,5,8,"div",33),e.k0s()(),e.nrm(45,"br")(46,"br"),e.j41(47,"div",31),e.EFF(48,"Unit\xe9s d'organisation"),e.k0s(),e.j41(49,"div",34),e.DNE(50,M,9,7,"div",35),e.k0s()()()()()}if(2&r){const t=e.XpG();e.R7$(),e.Y8G("id","create-update-user-modal")("modalContentWidth","large-width")("modalActionColor",t.isEditMode?"warning-back":"success-back")("showCloseButton",!0)("modalTitle",t.isEditMode?"Modifier un utilisateur":"Ajouter un utilisateur")("cancelBtnName","Annuler")("submitBtnName",t.isEditMode?"Modifier":"Sauvegarder")("showBottomElements",!0)("showCancelButton",!0)("reloadApp",!1)("closeAfterSubmited",!1)("disableSubmitButton",!t.userForm.valid||t.orgUnitsIsEmpty()||t.rolesIsEmpty())("processing",t.isProcessing),e.R7$(2),e.Y8G("ngIf",t.message&&""!=t.message),e.R7$(2),e.Y8G("formGroup",t.userForm),e.R7$(16),e.Y8G("type",t.showPassword?"text":"password"),e.R7$(),e.HbH(t.showPassword?"fas fa-eye":"fas fa-eye-slash"),e.R7$(4),e.Y8G("type",t.showPassword?"text":"password"),e.R7$(),e.HbH(t.showPassword?"fas fa-eye":"fas fa-eye-slash"),e.R7$(17),e.Y8G("ngForOf",t.ORGUNITS.roles),e.R7$(6),e.Y8G("ngForOf",t.ORGUNITS.countries)}}let A=(()=>{class r{constructor(t,i,s,o){this.api=t,this.userCtx=i,this.mService=s,this.cst=o,this.ORGUNITS={countries:[],regions:[],prefectures:[],communes:[],hospitals:[],districtQuartiers:[],villageSecteurs:[],chws:[],recos:[],user:null,roles:[]},this.isEditMode=!1,this.isProcessing=!1,this.APP_LOGO="",this.countries=[],this.regions=[],this.prefectures=[],this.communes=[],this.hospitals=[],this.districtQuartiers=[],this.villageSecteurs=[],this.showPassword=!1,this.isToOpenList={},this.APP_LOGO=this.cst.APP_LOGO}ngOnInit(){1==this.IS_CREATE_OR_UPDATE&&(this.isEditMode=null!=this.ORGUNITS.user,this.userForm=this.userFormGroup(this.ORGUNITS.user),this.SELECTED_ROLE=this.ORGUNITS.user?.rolesIds??[],this.countries=this.ORGUNITS.user?.countries??[],this.regions=this.ORGUNITS.user?.regions??[],this.prefectures=this.ORGUNITS.user?.prefectures??[],this.communes=this.ORGUNITS.user?.communes??[],this.hospitals=this.ORGUNITS.user?.hospitals??[],this.districtQuartiers=this.ORGUNITS.user?.districtQuartiers??[],this.villageSecteurs=this.ORGUNITS.user?.villageSecteurs??[])}togglePasswordVisibility(){this.showPassword=!this.showPassword}isListOpenToShow(t){return this.isToOpenList[t]??!1}toggleList(t){this.isToOpenList[t]=!0!==this.isToOpenList[t]}orgUnitsIsEmpty(){return 0===[...this.countries??[],...this.regions??[],...this.prefectures??[],...this.communes??[],...this.hospitals??[],...this.districtQuartiers??[],...this.villageSecteurs??[]].length}rolesIsEmpty(){return 0===(this.SELECTED_ROLE??[]).length}containsOrgUnits(t,i){if("countries"===t){const s=(this.countries??[]).map(a=>a.id).includes(i),o=(this.regions??[]).map(a=>a.country_id),c=o.includes(i),d=this.generateRegions(i).length===o.length;return s||c&&d}if("regions"===t){const s=(this.regions??[]).map(a=>a.id).includes(i),o=(this.prefectures??[]).map(a=>a.region_id),c=o.includes(i),d=this.generatePrefectures(i).length===o.length;return s||c&&d}if("prefectures"===t){const s=(this.prefectures??[]).map(a=>a.id).includes(i),o=(this.communes??[]).map(a=>a.prefecture_id),c=o.includes(i),d=this.generateCommunes(i).length===o.length;return s||c&&d}if("communes"===t){const s=(this.communes??[]).map(a=>a.id).includes(i),o=(this.hospitals??[]).map(a=>a.commune_id),c=o.includes(i),d=this.generateHospitals(i).length===o.length;return s||c&&d}if("hospitals"===t){const s=(this.hospitals??[]).map(a=>a.id).includes(i),o=(this.districtQuartiers??[]).map(a=>a.hospital_id),c=o.includes(i),d=this.generateDistrictQuartiers(i).length===o.length;return s||c&&d}if("districtQuartiers"===t){const s=(this.districtQuartiers??[]).map(a=>a.id).includes(i),o=(this.villageSecteurs??[]).map(a=>a.district_quartier_id),c=o.includes(i),d=this.generateVillageSecteurs(i).length===o.length;return s||c&&d}return"villageSecteurs"===t&&(this.villageSecteurs??[]).map(o=>o.id).includes(i)}generateRegions(t){return this.ORGUNITS.regions.filter(i=>t===i.country_id)}generatePrefectures(t){return this.ORGUNITS.prefectures.filter(i=>t===i.region_id)}generateCommunes(t){return this.ORGUNITS.communes.filter(i=>t===i.prefecture_id)}generateHospitals(t){return this.ORGUNITS.hospitals.filter(i=>t===i.commune_id)}generateDistrictQuartiers(t){return this.ORGUNITS.districtQuartiers.filter(i=>t===i.hospital_id)}generateVillageSecteurs(t){return this.ORGUNITS.villageSecteurs.filter(i=>t===i.district_quartier_id)}selectCountries(t){const i=this.findObj(this.countries,t).index;-1!==i?(this.countries.splice(i,1),this.regions=this.regions.filter(s=>s.country_id!==t.id),this.prefectures=this.prefectures.filter(s=>s.country_id!==t.id),this.communes=this.communes.filter(s=>s.country_id!==t.id),this.hospitals=this.hospitals.filter(s=>s.country_id!==t.id),this.districtQuartiers=this.districtQuartiers.filter(s=>s.country_id!==t.id),this.villageSecteurs=this.villageSecteurs.filter(s=>s.country_id!==t.id)):(this.countries.push(t),this.regions=[...this.regions.filter(s=>s.country_id!==t.id),...this.ORGUNITS.regions.filter(s=>s.country_id===t.id)],this.prefectures=[...this.prefectures.filter(s=>s.country_id!==t.id),...this.ORGUNITS.prefectures.filter(s=>s.country_id===t.id)],this.communes=[...this.communes.filter(s=>s.country_id!==t.id),...this.ORGUNITS.communes.filter(s=>s.country_id===t.id)],this.hospitals=[...this.hospitals.filter(s=>s.country_id!==t.id),...this.ORGUNITS.hospitals.filter(s=>s.country_id===t.id)],this.districtQuartiers=[...this.districtQuartiers.filter(s=>s.country_id!==t.id),...this.ORGUNITS.districtQuartiers.filter(s=>s.country_id===t.id)],this.villageSecteurs=[...this.villageSecteurs.filter(s=>s.country_id!==t.id),...this.ORGUNITS.villageSecteurs.filter(s=>s.country_id===t.id)])}selectRegions(t){const i=this.findObj(this.regions,t).index;-1!==i?(this.regions.splice(i,1),this.prefectures=this.prefectures.filter(s=>s.region_id!==t.id),this.communes=this.communes.filter(s=>s.region_id!==t.id),this.hospitals=this.hospitals.filter(s=>s.region_id!==t.id),this.districtQuartiers=this.districtQuartiers.filter(s=>s.region_id!==t.id),this.villageSecteurs=this.villageSecteurs.filter(s=>s.region_id!==t.id)):(this.regions.push(t),this.prefectures=[...this.prefectures.filter(s=>s.region_id!==t.id),...this.ORGUNITS.prefectures.filter(s=>s.region_id===t.id)],this.communes=[...this.communes.filter(s=>s.region_id!==t.id),...this.ORGUNITS.communes.filter(s=>s.region_id===t.id)],this.hospitals=[...this.hospitals.filter(s=>s.region_id!==t.id),...this.ORGUNITS.hospitals.filter(s=>s.region_id===t.id)],this.districtQuartiers=[...this.districtQuartiers.filter(s=>s.region_id!==t.id),...this.ORGUNITS.districtQuartiers.filter(s=>s.region_id===t.id)],this.villageSecteurs=[...this.villageSecteurs.filter(s=>s.region_id!==t.id),...this.ORGUNITS.villageSecteurs.filter(s=>s.country_id===t.id)])}selectPrefectures(t){const i=this.findObj(this.prefectures,t).index;-1!==i?(this.prefectures.splice(i,1),this.communes=this.communes.filter(s=>s.prefecture_id!==t.id),this.hospitals=this.hospitals.filter(s=>s.prefecture_id!==t.id),this.districtQuartiers=this.districtQuartiers.filter(s=>s.prefecture_id!==t.id),this.villageSecteurs=this.villageSecteurs.filter(s=>s.prefecture_id!==t.id)):(this.prefectures.push(t),this.communes=[...this.communes.filter(s=>s.prefecture_id!==t.id),...this.ORGUNITS.communes.filter(s=>s.prefecture_id===t.id)],this.hospitals=[...this.hospitals.filter(s=>s.prefecture_id!==t.id),...this.ORGUNITS.hospitals.filter(s=>s.prefecture_id===t.id)],this.districtQuartiers=[...this.districtQuartiers.filter(s=>s.prefecture_id!==t.id),...this.ORGUNITS.districtQuartiers.filter(s=>s.prefecture_id===t.id)],this.villageSecteurs=[...this.villageSecteurs.filter(s=>s.prefecture_id!==t.id),...this.ORGUNITS.villageSecteurs.filter(s=>s.prefecture_id===t.id)])}selectCommunes(t){const i=this.findObj(this.communes,t).index;-1!==i?(this.communes.splice(i,1),this.hospitals=this.hospitals.filter(s=>s.commune_id!==t.id),this.districtQuartiers=this.districtQuartiers.filter(s=>s.commune_id!==t.id),this.villageSecteurs=this.villageSecteurs.filter(s=>s.commune_id!==t.id)):(this.communes.push(t),this.hospitals=[...this.hospitals.filter(s=>s.commune_id!==t.id),...this.ORGUNITS.hospitals.filter(s=>s.commune_id===t.id)],this.districtQuartiers=[...this.districtQuartiers.filter(s=>s.commune_id!==t.id),...this.ORGUNITS.districtQuartiers.filter(s=>s.commune_id===t.id)],this.villageSecteurs=[...this.villageSecteurs.filter(s=>s.commune_id!==t.id),...this.ORGUNITS.villageSecteurs.filter(s=>s.commune_id===t.id)])}selectHospitals(t){const i=this.findObj(this.hospitals,t).index;-1!==i?(this.hospitals.splice(i,1),this.districtQuartiers=this.districtQuartiers.filter(s=>s.hospital_id!==t.id),this.villageSecteurs=this.villageSecteurs.filter(s=>s.hospital_id!==t.id)):(this.hospitals.push(t),this.districtQuartiers=[...this.districtQuartiers.filter(s=>s.hospital_id!==t.id),...this.ORGUNITS.districtQuartiers.filter(s=>s.hospital_id===t.id)],this.villageSecteurs=[...this.villageSecteurs.filter(s=>s.hospital_id!==t.id),...this.ORGUNITS.villageSecteurs.filter(s=>s.hospital_id===t.id)])}selectDistrictQuartiers(t){const i=this.findObj(this.districtQuartiers,t).index;-1!==i?(this.districtQuartiers.splice(i,1),this.villageSecteurs=this.villageSecteurs.filter(s=>s.district_quartier_id!==t.id)):(this.districtQuartiers.push(t),this.villageSecteurs=[...this.villageSecteurs.filter(s=>s.district_quartier_id!==t.id),...this.ORGUNITS.villageSecteurs.filter(s=>s.district_quartier_id===t.id)])}selectVillageSecteurs(t){const i=this.findObj(this.villageSecteurs,t).index;-1!==i?this.villageSecteurs.splice(i,1):this.villageSecteurs.push(t)}userFormGroup(t){const i=!!t,s=t?.username??"",o={username:new l.MJ({value:s,disabled:i&&""!=s},[l.k0.required,l.k0.minLength(4)]),fullname:new l.MJ(t?.fullname??""),email:new l.MJ(t?.email??""),isActive:new l.MJ(!0===t?.isActive),password:new l.MJ("",i?[l.k0.minLength(8)]:[l.k0.required,l.k0.minLength(8)]),passwordConfirm:new l.MJ("",i?[l.k0.minLength(8)]:[l.k0.required,l.k0.minLength(8)])},c=i?null:[this.matchValidator("password","passwordConfirm",8)];return new l.gE(o,c)}findObj(t,i){const[s,o]=(()=>{let c=-1;return[t.find((a,m)=>a.id===i.id&&(c=m,!0)),c]})();return{found:s,index:o}}matchValidator(t,i,s){return o=>{const c=o.get(t),d=o.get(i);return c&&d&&c.value!==d.value?(c.value?.length>=s&&d.value?.length>=s&&(this.message="Les mots de passe ne sont pas identiques!"),{mismatch:!0}):null}}passwordMatchError(t){return!t||t.getError("password")&&t.get("passwordConfirm")?.touched}addOrRemoveRole(t){const i=this.SELECTED_ROLE.indexOf(t);-1!==i?this.SELECTED_ROLE.splice(i,1):this.SELECTED_ROLE.push(t)}registerOrUpdate(){this.message="",this.isProcessing=!0;const t=this.userForm.value.password,i=this.userForm.value.passwordConfirm,s=!t?.trim(),o=!i?.trim(),c=!s&&t!==i;if(this.isEditMode){if((t||i)&&c)return this.message="Les mots de passe ne concordent pas. Effacez-les si vous ne souhaitez pas les modifier.",void(this.isProcessing=!1)}else{if(s)return this.message="Le mot de passe est obligatoire.",void(this.isProcessing=!1);if(o)return this.message="Veuillez confirmer le mot de passe.",void(this.isProcessing=!1);if(c)return this.message="Les mots de passe ne concordent pas.",void(this.isProcessing=!1)}if(this.orgUnitsIsEmpty()||this.rolesIsEmpty())return this.message="Les unit\xe9s organisationnelles ou les r\xf4les sont vides. Ils sont requis.",void(this.isProcessing=!1);const d={id:this.ORGUNITS?.user?.id,username:this.ORGUNITS?.user?.username??this.userForm.value.username,fullname:this.userForm.value.fullname,email:this.userForm.value.email,password:s?void 0:t,isActive:!0===this.userForm.value.isActive,roles:this.SELECTED_ROLE,countries:this.countries,regions:this.regions,prefectures:this.prefectures,communes:this.communes,hospitals:this.hospitals,districtQuartiers:this.districtQuartiers,villageSecteurs:this.villageSecteurs,chws:this.ORGUNITS.chws.filter(m=>this.districtQuartiers.some(T=>T.id===m.district_quartier_id)),recos:this.ORGUNITS.recos.filter(m=>this.villageSecteurs.some(T=>T.id===m.village_secteur_id))};(this.ORGUNITS?.user?this.api.updateUser(d):this.api.register(d)).subscribe(m=>{200===m.status?this.mService.close(this.ORGUNITS?.user?{updated:!0}:{registered:!0}):(this.message=m.data,this.isProcessing=!1)},m=>{this.message="Erreur inconnue!",this.isProcessing=!1})}delete(){var t=this;return(0,R.A)(function*(){t.message="",t.isProcessing=!0;const i=yield t.userCtx.currentUser();t.SELECTED_USER&&i&&t.SELECTED_USER.id!=i.id?t.api.deleteUser(t.SELECTED_USER).subscribe(s=>{200===s.status?t.mService.close({deleted:!0}):(t.message="Erreur lors de la suppression, reessayez!",t.isProcessing=!1)},s=>{t.message="Erreur lors de la suppression, reessayez!",t.isProcessing=!1}):(t.message="Vous ne pouvez supprimer cet utilisateur",t.isProcessing=!1)})()}containsRole(t){return this.SELECTED_ROLE.includes(t)}titleCase(t){return(0,b.Sn)(t)}static{this.\u0275fac=function(i){return new(i||r)(e.rXU(C.G),e.rXU(v.i),e.rXU(f.B),e.rXU(S.D))}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-create-update-delete-users"]],inputs:{SELECTED_ROLE:"SELECTED_ROLE",SELECTED_USER:"SELECTED_USER",IS_SHOW_ROLES:"IS_SHOW_ROLES",ROLES:"ROLES",IS_DELETE_MODE:"IS_DELETE_MODE",IS_CREATE_OR_UPDATE:"IS_CREATE_OR_UPDATE",ORGUNITS:"ORGUNITS"},standalone:!1,decls:3,vars:3,consts:[[4,"ngIf"],[3,"id","modalActionColor","showCloseButton","modalTitle","cancelBtnName","submitBtnName","showBottomElements"],["height","30","alt","","srcset","",1,"modal-title",3,"src"],[4,"ngFor","ngForOf"],[2,"margin-left","5px"],["type","checkbox",3,"checked","disabled"],[3,"onSubmit","id","modalActionColor","showCloseButton","modalTitle","cancelBtnName","submitBtnName","showBottomElements","showCancelButton","reloadApp","closeAfterSubmited","processing"],["style","color: rgb(88, 0, 0); text-align: center;",4,"ngIf"],[2,"color","rgb(88, 0, 0)","text-align","center"],[3,"onSubmit","id","modalContentWidth","modalActionColor","showCloseButton","modalTitle","cancelBtnName","submitBtnName","showBottomElements","showCancelButton","reloadApp","closeAfterSubmited","disableSubmitButton","processing"],[2,"min-height","25px","text-align","center","padding","5px 2px"],["style","color: rgb(183, 0, 0);",4,"ngIf"],[1,"user-container"],["autocomplete","off","novalidate","",1,"form-horizontal",3,"formGroup"],[1,"section-title","mt-5"],[1,"row"],[1,"input-group","col-md-6"],[1,"input-group-icon"],[1,"fas","fa-user"],["id","username","type","text","placeholder","Username","formControlName","username"],["id","fullname","type","text","placeholder","Nom complet","formControlName","fullname"],[1,"fas","fa-lock"],["placeholder","Mot de passe","formControlName","password","autocomplete","new-password",3,"type"],[3,"click"],["placeholder","Confirmer mot de passe","formControlName","passwordConfirm",3,"type"],[2,"color","gray","font-style","italic","margin-top","-20px"],[1,"fas","fa-envelope"],["autocomplete","off","id","email","type","email","placeholder","Email","formControlName","email",1,"form-control"],[1,"custom-checkbox","col-md-6"],["type","checkbox","id","isActive","formControlName","isActive","autocomplete","off"],["for","isActive"],[1,"section-title"],[1,"user-role"],["class","custom-checkbox col-md-4",4,"ngFor","ngForOf"],[1,"user-orgunits"],["class","org-units-checkbox-parent",4,"ngFor","ngForOf"],[2,"color","rgb(183, 0, 0)"],[1,"custom-checkbox","col-md-4"],["type","checkbox",3,"change","id","checked"],[3,"for"],[1,"org-units-checkbox-parent"],[1,"custom-checkbox","input-checkbox-group"],["type","button",1,"list-unlist",3,"click"],["type","checkbox",1,"org-units-check-input",3,"change","checked","id"],[1,"form-check-label","org-units-label",3,"for"],["class","org-units-checkbox-parent checkbox-list",3,"ngClass",4,"ngFor","ngForOf"],[1,"org-units-checkbox-parent","checkbox-list",3,"ngClass"]],template:function(i,s){1&i&&e.DNE(0,G,4,9,"div",0)(1,O,7,12,"div",0)(2,z,51,25,"div",0),2&i&&(e.Y8G("ngIf",1==s.IS_SHOW_ROLES),e.R7$(),e.Y8G("ngIf",1==s.IS_DELETE_MODE),e.R7$(),e.Y8G("ngIf",1==s.IS_CREATE_OR_UPDATE))},dependencies:[_.E,_.G,_.I,l.qT,l.me,l.Zm,l.BC,l.cb,l.j4,l.JD,F.z,E],styles:[".user-container[_ngcontent-%COMP%]{height:100%!important;overflow-y:auto!important}.user-role[_ngcontent-%COMP%], .user-orgunits[_ngcontent-%COMP%]{overflow-y:auto!important;overflow-x:hidden!important;border:1px darkblue dashed!important;padding:10px!important}.user-role[_ngcontent-%COMP%]{max-height:150px!important}.user-orgunits[_ngcontent-%COMP%]{max-height:300px!important}"]})}}return r})();var x=u(2365);function V(r,n){if(1&r){const t=e.RV6();e.j41(0,"button",5),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.openCreateOrEditUserModal())}),e.nrm(1,"i",6),e.EFF(2," Nouvel utilisateur "),e.k0s()}}function Y(r,n){1&r&&e.nrm(0,"th",7)}function Q(r,n){if(1&r){const t=e.RV6();e.j41(0,"i",13),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2).$implicit,o=e.XpG();return e.Njj(o.openSelectedRolesModal(s))}),e.k0s()}}function J(r,n){if(1&r&&(e.j41(0,"span",14),e.EFF(1),e.k0s()),2&r){const t=e.XpG(2).$implicit;e.R7$(),e.JRh(t.isActive?"":"\u2713")}}function H(r,n){if(1&r&&(e.j41(0,"span",14),e.EFF(1),e.k0s()),2&r){const t=e.XpG(2).$implicit,i=e.XpG();e.R7$(),e.JRh(i.isSuperUser(t)?"\u2713":"")}}function W(r,n){if(1&r){const t=e.RV6();e.j41(0,"i",17),e.bIt("click",function(){e.eBV(t);const s=e.XpG(3).$implicit,o=e.XpG();return e.Njj(o.openCreateOrEditUserModal(s))}),e.k0s()}if(2&r){const t=e.XpG(3).$implicit;e.ZvI("fas fa-edit ",t.isDeleted?"":"update-color","")}}function K(r,n){if(1&r){const t=e.RV6();e.j41(0,"i",17),e.bIt("click",function(){e.eBV(t);const s=e.XpG(3).$implicit,o=e.XpG();return e.Njj(o.openDeleteUserModal(s))}),e.k0s()}if(2&r){const t=e.XpG(3).$implicit;e.ZvI("fas fa-trash-alt ",t.isDeleted?"":"delete-color","")}}function Z(r,n){1&r&&e.nrm(0,"i",18)}function q(r,n){if(1&r&&(e.qex(0),e.j41(1,"td"),e.DNE(2,W,1,3,"i",15),e.k0s(),e.j41(3,"td"),e.DNE(4,K,1,3,"i",15),e.k0s(),e.j41(5,"td"),e.DNE(6,Z,1,0,"i",16),e.k0s(),e.bVm()),2&r){const t=e.XpG(2).$implicit,i=e.XpG();e.R7$(2),e.Y8G("ngIf",1==(null==i.USER||null==i.USER.role?null:i.USER.role.canUpdateUser)&&!t.isDeleted&&!i.isSuperUser(t)||1==(null==i.USER||null==i.USER.role?null:i.USER.role.isSuperUser)),e.R7$(2),e.Y8G("ngIf",1==(null==i.USER||null==i.USER.role?null:i.USER.role.canDeleteUser)&&!t.isDeleted&&!i.isSuperUser(t)),e.R7$(2),e.Y8G("ngIf",!t.isDeleted&&i.isSuperUser(t))}}function ee(r,n){if(1&r&&(e.j41(0,"tr")(1,"td",9),e.EFF(2),e.k0s(),e.j41(3,"td"),e.EFF(4),e.k0s(),e.j41(5,"td"),e.EFF(6),e.k0s(),e.j41(7,"td"),e.EFF(8),e.k0s(),e.j41(9,"td"),e.DNE(10,Q,1,0,"i",10),e.k0s(),e.j41(11,"td"),e.DNE(12,J,2,1,"span",11),e.k0s(),e.j41(13,"td"),e.DNE(14,H,2,1,"span",11),e.k0s(),e.DNE(15,q,7,3,"ng-container",12),e.k0s()),2&r){const t=e.XpG(),i=t.$implicit,s=t.index,o=e.XpG();e.HbH(i.isDeleted?"deleted-user":"undeleted-user"),e.R7$(2),e.JRh(s+1),e.R7$(2),e.JRh(i.username),e.R7$(2),e.JRh(i.fullname),e.R7$(2),e.JRh(i.email),e.R7$(2),e.Y8G("ngIf",!i.isDeleted),e.R7$(2),e.Y8G("ngIf",!i.isDeleted),e.R7$(2),e.Y8G("ngIf",!i.isDeleted),e.R7$(),e.Y8G("ngIf",1==(null==o.USER||null==o.USER.role?null:o.USER.role.canUpdateUser)||1==(null==o.USER||null==o.USER.role?null:o.USER.role.canDeleteUser))}}function te(r,n){if(1&r&&(e.j41(0,"tbody"),e.DNE(1,ee,16,10,"tr",8),e.k0s()),2&r){const t=n.$implicit,i=e.XpG();e.R7$(),e.Y8G("ngIf",!i.isSuperUser(t)||1==(null==i.USER||null==i.USER.role?null:i.USER.role.isSuperUser))}}let se=(()=>{class r{constructor(t,i,s,o,c){this.userCtx=t,this.api=i,this.snackbar=s,this.mService=o,this.cst=c,this.users$=[],this.roles$=[],this.APP_LOGO="",this.countriesList=[],this.regionsList=[],this.prefecturesList=[],this.communesList=[],this.hospitalsList=[],this.districtQuartiersList=[],this.villageSecteursList=[],this.chwsList=[],this.recosList=[],this.initializeComponent()}initializeComponent(){var t=this;return(0,R.A)(function*(){t.APP_LOGO=t.cst.APP_LOGO,t.USER=yield t.userCtx.currentUser()})()}ngOnInit(){this.GetUsers(),this.GetRoles(),this.GetCountries(),this.GetRegions(),this.GetPrefectures(),this.GetCommunes(),this.GetHospitals(),this.GetDistrictQuartiers(),this.GetVillageSecteurs(),this.GetChws(),this.GetRecos()}OrgUnitsIsEmpty(t){return 0===[...t.countries??[],...t.regions??[],...t.prefectures??[],...t.communes??[],...t.hospitals??[],...t.districtQuartiers??[],...t.villageSecteurs??[]].length}isSuperUser(t){return!0===(0,b.H0)(t.authorizations??[],t.routes??[])?.isSuperUser}GetRoles(){this.api.GetRoles().subscribe(t=>{200==t.status&&(this.roles$=t.data)},t=>{})}GetUsers(){this.api.getUsers().subscribe(t=>{200===t.status&&(this.users$=t.data)},t=>{console.log(t)})}GetCountries(){this.api.GetCountries().subscribe(t=>{200===t.status&&(this.countriesList=t.data)},t=>{console.log(t)})}GetRegions(){this.api.GetRegions().subscribe(t=>{200===t.status&&(this.regionsList=t.data)},t=>{console.log(t)})}GetPrefectures(){this.api.GetPrefectures().subscribe(t=>{200===t.status&&(this.prefecturesList=t.data)},t=>{console.log(t)})}GetCommunes(){this.api.GetCommunes().subscribe(t=>{200===t.status&&(this.communesList=t.data)},t=>{console.log(t)})}GetHospitals(){this.api.GetHospitals().subscribe(t=>{200===t.status&&(this.hospitalsList=t.data)},t=>{console.log(t)})}GetDistrictQuartiers(){this.api.GetDistrictQuartiers().subscribe(t=>{200===t.status&&(this.districtQuartiersList=t.data)},t=>{console.log(t)})}GetVillageSecteurs(){this.api.GetVillageSecteurs().subscribe(t=>{200===t.status&&(this.villageSecteursList=t.data)},t=>{console.log(t)})}GetChws(){this.api.GetChws().subscribe(t=>{200===t.status&&(this.chwsList=t.data)},t=>{console.log(t)})}GetRecos(){this.api.GetRecos().subscribe(t=>{200===t.status&&(this.recosList=t.data)},t=>{console.log(t)})}generateSelectedUser(t){return{countries:this.countriesList,regions:this.regionsList,prefectures:this.prefecturesList,communes:this.communesList,hospitals:this.hospitalsList,districtQuartiers:this.districtQuartiersList,villageSecteurs:this.villageSecteursList,chws:this.chwsList,recos:this.recosList,user:t??null,roles:this.roles$}}openDeleteUserModal(t){this.mService.open(A,{data:{SELECTED_USER:t,IS_DELETE_MODE:!0}}).subscribe(i=>{if(i&&1==i.deleted)return this.GetUsers(),this.snackbar.show({msg:"Supprim\xe9 avec succ\xe8s!",color:"success",duration:3e3})})}openCreateOrEditUserModal(t){this.mService.open(A,{data:{ORGUNITS:this.generateSelectedUser(t),IS_CREATE_OR_UPDATE:!0}}).subscribe(i=>{if(i){if(1==i.registered)return this.GetUsers(),this.snackbar.show({msg:"Sauvegard\xe9 avec succ\xe8s",color:"success",duration:3e3});if(1==i.updated)return this.GetUsers(),this.snackbar.show({msg:"Modifi\xe9 avec succ\xe8s",color:"success",duration:3e3})}})}openSelectedRolesModal(t){const i=t.roles.filter(s=>s&&s.id).map(s=>s.id);this.mService.open(A,{data:{SELECTED_USER:t,ROLES:this.roles$,SELECTED_ROLE:i,IS_SHOW_ROLES:!0}})}static{this.\u0275fac=function(i){return new(i||r)(e.rXU(v.i),e.rXU(C.G),e.rXU(x.z),e.rXU(f.B),e.rXU(S.D))}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-users-view"]],standalone:!1,decls:23,vars:3,consts:[[2,"display","flex","align-items","center","justify-content","space-between","margin","15px 10px 5px 10px"],["style","width: auto; float: right; background: green; color: aliceblue; font-weight: bold; font-size: 14px;","type","button","class","btn",3,"click",4,"ngIf"],[1,"table","table-white"],["colspan","3",4,"ngIf"],[4,"ngFor","ngForOf"],["type","button",1,"btn",2,"width","auto","float","right","background","green","color","aliceblue","font-weight","bold","font-size","14px",3,"click"],[1,"fa","fa-add",2,"font-size","15px"],["colspan","3"],[3,"class",4,"ngIf"],["scope","row"],["style","cursor: pointer;","class","fas fa-eye",3,"click",4,"ngIf"],["style","font-size: 18px; font-weight: bold;",4,"ngIf"],[4,"ngIf"],[1,"fas","fa-eye",2,"cursor","pointer",3,"click"],[2,"font-size","18px","font-weight","bold"],[3,"class","click",4,"ngIf"],["style","cursor: pointer; font-size: 18px;","class","fas fa-lock",4,"ngIf"],[3,"click"],[1,"fas","fa-lock",2,"cursor","pointer","font-size","18px"]],template:function(i,s){1&i&&(e.j41(0,"div",0)(1,"h2"),e.EFF(2,"Utilisateurs"),e.k0s(),e.DNE(3,V,3,0,"button",1),e.k0s(),e.j41(4,"table",2)(5,"thead")(6,"tr")(7,"th"),e.EFF(8,"N\xb0"),e.k0s(),e.j41(9,"th"),e.EFF(10,"Username"),e.k0s(),e.j41(11,"th"),e.EFF(12,"Full name"),e.k0s(),e.j41(13,"th"),e.EFF(14,"Email"),e.k0s(),e.j41(15,"th"),e.EFF(16,"R\xf4les"),e.k0s(),e.j41(17,"th"),e.EFF(18,"Inactifs"),e.k0s(),e.j41(19,"th"),e.EFF(20,"isSuperUser"),e.k0s(),e.DNE(21,Y,1,0,"th",3),e.k0s()(),e.DNE(22,te,2,1,"tbody",4),e.k0s()),2&i&&(e.R7$(3),e.Y8G("ngIf",1==(null==s.USER||null==s.USER.role?null:s.USER.role.canCreateUser)),e.R7$(18),e.Y8G("ngIf",1==(null==s.USER||null==s.USER.role?null:s.USER.role.canUpdateUser)||1==(null==s.USER||null==s.USER.role?null:s.USER.role.canDeleteUser)),e.R7$(),e.Y8G("ngForOf",s.users$))},dependencies:[_.G,_.I],encapsulation:2})}}return r})();function ie(r,n){if(1&r&&(e.j41(0,"div",3),e.EFF(1),e.k0s()),2&r){const t=e.XpG(2);e.R7$(),e.JRh(t.message)}}function re(r,n){if(1&r){const t=e.RV6();e.j41(0,"div")(1,"kossi-modal-layout",1),e.bIt("onSubmit",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.delete())}),e.j41(2,"div"),e.EFF(3,"\xcates-vous s\xfbr de vouloir supprimer ce r\xf4le ?"),e.k0s(),e.j41(4,"div"),e.EFF(5,"Cette action est ir\xe9versible! \xcates vous s\xfbr de proc\xe9der \xe0 la suppression ?"),e.k0s(),e.DNE(6,ie,2,1,"div",2),e.k0s()()}if(2&r){const t=e.XpG();e.R7$(),e.Y8G("id","role-delete-confirm-modal")("modalActionColor","danger-back")("showCloseButton",!0)("modalTitle","Suppression de R\xd4LE: ")("cancelBtnName","Annuler")("submitBtnName","Oui Supprimer")("showBottomElements",!0)("showCancelButton",!0)("reloadApp",!1)("closeAfterSubmited",!1)("processing",t.isProcessing),e.R7$(5),e.Y8G("ngIf",t.message&&""!=t.message)}}function oe(r,n){if(1&r&&(e.j41(0,"span",18),e.EFF(1),e.k0s()),2&r){const t=e.XpG(2);e.R7$(),e.JRh(t.message)}}function ne(r,n){if(1&r){const t=e.RV6();e.j41(0,"div",19)(1,"input",20),e.bIt("click",function(){const s=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.addOrRemoveRoute(s))}),e.k0s(),e.j41(2,"label",21),e.EFF(3),e.k0s()()}if(2&r){const t=n.$implicit,i=e.XpG(2);e.R7$(),e.Mz_("id","add-remove-routes-",t.label,""),e.Y8G("checked",i.containsRoute(t)),e.R7$(),e.Mz_("for","add-remove-routes-",t.label,""),e.R7$(),e.JRh(t.label)}}function le(r,n){if(1&r){const t=e.RV6();e.j41(0,"div",19)(1,"input",22),e.bIt("click",function(){const s=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.addOrRemoveAutorization(s))}),e.k0s(),e.j41(2,"label",21),e.EFF(3),e.k0s()()}if(2&r){const t=n.$implicit,i=e.XpG(2);e.R7$(),e.Mz_("id","add-remove-autorization-",t,""),e.Y8G("checked",i.containsAutorization(t)),e.R7$(),e.Mz_("for","add-remove-autorization-",t,""),e.R7$(),e.JRh(t)}}function ae(r,n){if(1&r){const t=e.RV6();e.j41(0,"div")(1,"kossi-modal-layout",4),e.bIt("onSubmit",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.createOrUpdate())}),e.j41(2,"div",5),e.DNE(3,oe,2,1,"span",6),e.k0s(),e.j41(4,"h1"),e.EFF(5),e.k0s(),e.j41(6,"div",7)(7,"form",8)(8,"div",9)(9,"div",10)(10,"span",11),e.nrm(11,"i",12),e.k0s(),e.nrm(12,"input",13),e.k0s()(),e.nrm(13,"br"),e.j41(14,"div",14),e.EFF(15,"Pages d'acc\xe8s \xe0 celui qui aura ce role"),e.k0s(),e.j41(16,"div",15)(17,"div",9),e.DNE(18,ne,4,6,"div",16),e.k0s()(),e.nrm(19,"br"),e.j41(20,"div",14),e.EFF(21,"Authorizations d'actions pour ce role"),e.k0s(),e.j41(22,"div",17)(23,"div",9),e.DNE(24,le,4,6,"div",16),e.k0s()()()()()()}if(2&r){const t=e.XpG();e.R7$(),e.Y8G("id","user-create-update-modal")("modalContentWidth","large-width")("modalActionColor",t.isEditMode?"warning-back":"success-back")("showCloseButton",!0)("modalTitle",t.isEditMode?"Modifier un R\xd4LE":"Ajouter un R\xd4LE")("cancelBtnName","Annuler")("submitBtnName",t.isEditMode?"Modifier":"Sauvegarder")("showBottomElements",!0)("showCancelButton",!0)("reloadApp",!1)("closeAfterSubmited",!1)("disableSubmitButton",!t.isValidForm())("processing",t.isProcessing),e.R7$(2),e.Y8G("ngIf",t.message&&""!=t.message),e.R7$(2),e.JRh(t.isProcessing),e.R7$(2),e.Y8G("formGroup",t.roleForm),e.R7$(11),e.Y8G("ngForOf",t.DATAS.routes),e.R7$(6),e.Y8G("ngForOf",t.DATAS.authorizations)}}let $=(()=>{class r{constructor(t,i,s,o){this.api=t,this.userCtx=i,this.mService=s,this.cst=o,this.DATAS={roles:[],routes:[],authorizations:[],role:null},this.isEditMode=!1,this.isProcessing=!1,this.selectedRoute=[],this.selectedAutorization=[],this.message="",this.APP_LOGO="",this.APP_LOGO=this.cst.APP_LOGO}ngOnInit(){1==this.IS_CREATE_OR_UPDATE&&(this.DATAS.role&&(this.selectedRoute=this.DATAS.routes.filter(t=>(this.DATAS.role.routes??[]).map(i=>i.path).includes(t.path)),this.selectedAutorization=this.DATAS.authorizations.filter(t=>(this.DATAS.role.authorizations??[]).includes(t))),this.roleForm=this.createFormGroup(this.DATAS.role))}isValidForm(){return""!=(this.roleForm?.value.name??"")&&this.selectedRoute.length>0&&this.selectedAutorization.length>0}containsRoute(t){return null!=this.selectedRoute.find(s=>s.path===t.path)}containsAutorization(t){return this.selectedAutorization.includes(t)}addOrRemoveRoute(t){const[i,s]=(()=>{let o=-1;return[this.selectedRoute.find((d,a)=>d.path===t.path&&(o=a,!0)),o]})();-1!==s?this.selectedRoute.splice(s,1):this.selectedRoute.push(t)}selectAllRoutes(){this.selectedRoute=this.selectedRoute.length==this.DATAS.routes.length?[]:this.DATAS.routes}selectAllAuthorizations(){this.selectedAutorization=this.selectedAutorization.length==this.DATAS.authorizations.length?[]:this.DATAS.authorizations}addOrRemoveAutorization(t){const[i,s]=(()=>{let o=-1;return[this.selectedAutorization.find((d,a)=>d===t&&(o=a,!0)),o]})();-1!==s?this.selectedAutorization.splice(s,1):this.selectedAutorization.push(t)}createFormGroup(t){const i=!!t,s=t?.name??"",o={name:new l.MJ({value:s,disabled:i&&""!=s},[l.k0.required,l.k0.minLength(4)])};return new l.gE(o)}toStringNewLine(t,i){return null!=t?`${t}`.toString().replace(/,/g,"<br>"):""}createOrUpdate(){this.message="",this.isProcessing=!0;const t={id:this.DATAS?.role?.id,name:this.DATAS?.role?.name??this.roleForm.value.name,routes:this.selectedRoute,authorizations:this.selectedAutorization};return(t.name??"").length<4?(this.message="Le nom ne doit pas \xeatre vide.",void(this.isProcessing=!1)):t.routes.length<=0?(this.message="Selectionner au moins une route pour ce roles",void(this.isProcessing=!1)):t.authorizations.length<=0?(this.message="Selectionner au moins une authorizations pour ce roles",void(this.isProcessing=!1)):void(this.DATAS?.role?this.api.UpdateRole(t):this.api.CreateRole(t)).subscribe(s=>{200===s.status?this.mService.close(this.DATAS?.role?{updated:!0}:{created:!0}):(this.message=s.data,this.isProcessing=!1)},s=>{this.message="Erreur inconnue!",this.isProcessing=!1})}delete(){this.message="",this.isProcessing=!0,this.SELECTED_ROLE&&this.SELECTED_ROLE.id?this.api.DeleteRole(this.SELECTED_ROLE).subscribe(t=>{200===t.status?this.mService.close({deleted:!0}):(this.message="Erreur lors de la suppression, reessayez!",this.isProcessing=!1)},t=>{this.message="Erreur lors de la suppression, reessayez!",this.isProcessing=!1}):(this.message="Vous ne pouvez supprimer ce r\xf4le",this.isProcessing=!1)}static{this.\u0275fac=function(i){return new(i||r)(e.rXU(C.G),e.rXU(v.i),e.rXU(f.B),e.rXU(S.D))}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-create-update-delete-roles"]],inputs:{IS_DELETE_MODE:"IS_DELETE_MODE",SELECTED_ROLE:"SELECTED_ROLE",IS_CREATE_OR_UPDATE:"IS_CREATE_OR_UPDATE",DATAS:"DATAS"},standalone:!1,decls:2,vars:2,consts:[[4,"ngIf"],[3,"onSubmit","id","modalActionColor","showCloseButton","modalTitle","cancelBtnName","submitBtnName","showBottomElements","showCancelButton","reloadApp","closeAfterSubmited","processing"],["style","color: rgb(88, 0, 0); text-align: center;",4,"ngIf"],[2,"color","rgb(88, 0, 0)","text-align","center"],[3,"onSubmit","id","modalContentWidth","modalActionColor","showCloseButton","modalTitle","cancelBtnName","submitBtnName","showBottomElements","showCancelButton","reloadApp","closeAfterSubmited","disableSubmitButton","processing"],[2,"min-height","25px","text-align","center","padding","5px 2px"],["style","color: rgb(183, 0, 0);",4,"ngIf"],[1,"user-container"],["autocomplete","off","novalidate","",1,"form-horizontal",3,"formGroup"],[1,"row"],[1,"input-group","col-md-6"],[1,"input-group-icon"],[1,"fas","fa-user"],["type","text","placeholder","Name","formControlName","name"],[1,"section-title"],[1,"role-routes"],["class","custom-checkbox col-md-4",4,"ngFor","ngForOf"],[1,"role-authorizations"],[2,"color","rgb(183, 0, 0)"],[1,"custom-checkbox","col-md-4"],["type","checkbox",3,"click","id","checked"],[3,"for"],["type","checkbox",3,"click","checked","id"]],template:function(i,s){1&i&&e.DNE(0,re,7,12,"div",0)(1,ae,25,18,"div",0),2&i&&(e.Y8G("ngIf",1==s.IS_DELETE_MODE),e.R7$(),e.Y8G("ngIf",1==s.IS_CREATE_OR_UPDATE))},dependencies:[_.G,_.I,l.qT,l.me,l.BC,l.cb,l.j4,l.JD,F.z],styles:[".role-routes[_ngcontent-%COMP%], .role-authorizations[_ngcontent-%COMP%]{overflow-y:auto!important;overflow-x:hidden!important;border:1px darkblue dashed!important;padding:10px!important}.role-routes[_ngcontent-%COMP%]{max-height:300px!important}.role-authorizations[_ngcontent-%COMP%]{max-height:200px!important}"]})}}return r})();function ce(r,n){if(1&r){const t=e.RV6();e.j41(0,"button",6),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.openCreateOrEditRoleModal())}),e.nrm(1,"i",7),e.EFF(2," Nouveau r\xf4le "),e.k0s()}}function ue(r,n){1&r&&(e.j41(0,"th",8),e.EFF(1,"Actions"),e.k0s())}function de(r,n){if(1&r){const t=e.RV6();e.j41(0,"i",12),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2).$implicit,o=e.XpG();return e.Njj(o.openCreateOrEditRoleModal(s))}),e.k0s()}if(2&r){const t=e.XpG(2).$implicit;e.ZvI("fas fa-edit ",t.isDeleted?"":"update-color","")}}function _e(r,n){if(1&r){const t=e.RV6();e.j41(0,"i",12),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2).$implicit,o=e.XpG();return e.Njj(o.openDeleteRoleModal(s))}),e.k0s()}if(2&r){const t=e.XpG(2).$implicit;e.ZvI("fas fa-trash-alt ",t.isDeleted?"":"delete-color","")}}function he(r,n){if(1&r&&(e.qex(0),e.j41(1,"td"),e.DNE(2,de,1,3,"i",11),e.k0s(),e.j41(3,"td"),e.DNE(4,_e,1,3,"i",11),e.k0s(),e.bVm()),2&r){const t=e.XpG().$implicit,i=e.XpG();e.R7$(2),e.Y8G("ngIf",1==(null==i.USER||null==i.USER.role?null:i.USER.role.canUpdateRole)&&!(null!=t.authorizations&&t.authorizations.includes("_superuser"))),e.R7$(2),e.Y8G("ngIf",1==(null==i.USER||null==i.USER.role?null:i.USER.role.canDeleteRole)&&!(null!=t.authorizations&&t.authorizations.includes("_superuser")))}}function pe(r,n){if(1&r&&(e.j41(0,"tbody")(1,"tr")(2,"td",9),e.EFF(3),e.k0s(),e.j41(4,"td"),e.EFF(5),e.k0s(),e.DNE(6,he,5,2,"ng-container",10),e.k0s()()),2&r){const t=n.$implicit,i=e.XpG();e.R7$(),e.HbH(t.isDeleted?"deleted-user":"undeleted-user"),e.R7$(2),e.JRh(t.id),e.R7$(2),e.JRh(t.name),e.R7$(),e.Y8G("ngIf",1==(null==i.USER||null==i.USER.role?null:i.USER.role.canUpdateRole)||1==(null==i.USER||null==i.USER.role?null:i.USER.role.canDeleteRole))}}let me=(()=>{class r{constructor(t,i,s,o,c){this.userCtx=t,this.api=i,this.snackbar=s,this.mService=o,this.cst=c,this.roles$=[],this.routes$=[],this.authorizations$=[],this.APP_LOGO="",this.initializeComponent()}initializeComponent(){var t=this;return(0,R.A)(function*(){t.APP_LOGO=t.cst.APP_LOGO,t.USER=yield t.userCtx.currentUser()})()}ngOnInit(){this.GetRoles(),this.GetUserAuthorizations(),this.GetUserRoutes()}GetRoles(){var t=this;this.api.GetRoles().subscribe(function(){var i=(0,R.A)(function*(s){200==s.status&&(t.roles$=s.data)});return function(s){return i.apply(this,arguments)}}(),i=>{})}GetUserAuthorizations(){var t=this;this.api.UserAuthorizations().subscribe(function(){var i=(0,R.A)(function*(s){200==s.status&&(t.authorizations$=s.data)});return function(s){return i.apply(this,arguments)}}(),i=>{})}GetUserRoutes(){var t=this;this.api.UserRoutes().subscribe(function(){var i=(0,R.A)(function*(s){200==s.status&&(t.routes$=s.data)});return function(s){return i.apply(this,arguments)}}(),i=>{})}generateSelectedRole(t){return{roles:this.roles$,routes:this.routes$,authorizations:this.authorizations$,role:t??null}}openCreateOrEditRoleModal(t){this.mService.open($,{data:{DATAS:this.generateSelectedRole(t),IS_CREATE_OR_UPDATE:!0}}).subscribe(i=>{if(i){if(1==i.created)return this.GetRoles(),this.snackbar.show({msg:"Sauvegard\xe9 avec succ\xe8s",color:"success",duration:3e3});if(1==i.updated)return this.GetRoles(),this.snackbar.show({msg:"Modifi\xe9 avec succ\xe8s",color:"success",duration:3e3})}})}openDeleteRoleModal(t){this.mService.open($,{data:{SELECTED_ROLE:t,IS_DELETE_MODE:!0}}).subscribe(i=>{if(i&&1==i.deleted)return this.GetRoles(),this.snackbar.show({msg:"Supprim\xe9 avec succ\xe8s!",color:"success",duration:3e3})})}static{this.\u0275fac=function(i){return new(i||r)(e.rXU(v.i),e.rXU(C.G),e.rXU(x.z),e.rXU(f.B),e.rXU(S.D))}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["app-roles-view"]],standalone:!1,decls:13,vars:3,consts:[[2,"display","flex","align-items","center","justify-content","space-between","margin","15px 10px 5px 10px"],["style","width: auto; float: right; background: green; color: aliceblue; font-weight: bold; font-size: 14px;","type","button","class","btn",3,"click",4,"ngIf"],[1,"table","table-white"],["scope","col"],["colspan","2","scope","col",4,"ngIf"],[4,"ngFor","ngForOf"],["type","button",1,"btn",2,"width","auto","float","right","background","green","color","aliceblue","font-weight","bold","font-size","14px",3,"click"],[1,"fa","fa-add",2,"font-size","15px"],["colspan","2","scope","col"],["scope","row"],[4,"ngIf"],[3,"class","click",4,"ngIf"],[3,"click"]],template:function(i,s){1&i&&(e.j41(0,"div",0)(1,"h2"),e.EFF(2,"Roles d'acc\xe8s"),e.k0s(),e.DNE(3,ce,3,0,"button",1),e.k0s(),e.j41(4,"table",2)(5,"thead")(6,"tr")(7,"th",3),e.EFF(8,"id"),e.k0s(),e.j41(9,"th",3),e.EFF(10,"Name"),e.k0s(),e.DNE(11,ue,2,0,"th",4),e.k0s()(),e.DNE(12,pe,7,6,"tbody",5),e.k0s()),2&i&&(e.R7$(3),e.Y8G("ngIf",1==(null==s.USER||null==s.USER.role?null:s.USER.role.canCreateRole)),e.R7$(8),e.Y8G("ngIf",1==(null==s.USER||null==s.USER.role?null:s.USER.role.canUpdateRole)||1==(null==s.USER||null==s.USER.role?null:s.USER.role.canDeleteRole)),e.R7$(),e.Y8G("ngForOf",s.roles$))},dependencies:[_.G,_.I],encapsulation:2})}}return r})();function fe(r,n){1&r&&(e.j41(0,"button",6),e.EFF(1,"UTILISATEURS"),e.k0s())}function ge(r,n){1&r&&(e.j41(0,"button",7),e.EFF(1,"ROLES D'ACCES"),e.k0s())}function Re(r,n){if(1&r&&(e.j41(0,"div",8)(1,"h2"),e.EFF(2,"\u{1f4c8} Utilisateurs de l'application"),e.k0s(),e.nrm(3,"app-users-view",9),e.k0s()),2&r){const t=e.XpG();e.R7$(3),e.Y8G("CHANGE_STATE",t.CHANGE_STATE)}}function Ee(r,n){if(1&r&&(e.j41(0,"div",10)(1,"h2"),e.EFF(2,"\u{1f4ca} Roles des utilisateurs"),e.k0s(),e.nrm(3,"app-roles-view",9),e.k0s()),2&r){const t=e.XpG();e.R7$(3),e.Y8G("CHANGE_STATE",t.CHANGE_STATE)}}const Ue=[{path:"",component:(()=>{class r{constructor(t,i){this.userCtx=t,this.cst=i,this.CHANGE_STATE=null,this.APP_LOGO="",this.initializeComponent()}initializeComponent(){var t=this;return(0,R.A)(function*(){t.APP_LOGO=t.cst.APP_LOGO,t.USER=yield t.userCtx.currentUser(),(0,b.Ey)()})()}static{this.\u0275fac=function(i){return new(i||r)(e.rXU(v.i),e.rXU(S.D))}}static{this.\u0275cmp=e.VBU({type:r,selectors:[["dashboards-view"]],standalone:!1,decls:6,vars:4,consts:[[1,"nav-tabs"],["class","tab-link active","data-target","USERS",4,"ngIf"],["class","tab-link","data-target","ROLES",4,"ngIf"],[1,"tab-content"],["id","USERS","class","view active",4,"ngIf"],["id","ROLES","class","view",4,"ngIf"],["data-target","USERS",1,"tab-link","active"],["data-target","ROLES",1,"tab-link"],["id","USERS",1,"view","active"],[3,"CHANGE_STATE"],["id","ROLES",1,"view"]],template:function(i,s){1&i&&(e.j41(0,"div",0),e.DNE(1,fe,2,0,"button",1)(2,ge,2,0,"button",2),e.k0s(),e.j41(3,"div",3),e.DNE(4,Re,4,1,"div",4)(5,Ee,4,1,"div",5),e.k0s()),2&i&&(e.R7$(),e.Y8G("ngIf",1==(null==s.USER||null==s.USER.role?null:s.USER.role.canViewUsers)),e.R7$(),e.Y8G("ngIf",1==(null==s.USER||null==s.USER.role?null:s.USER.role.canViewRoles)),e.R7$(2),e.Y8G("ngIf",1==(null==s.USER||null==s.USER.role?null:s.USER.role.canViewUsers)),e.R7$(),e.Y8G("ngIf",1==(null==s.USER||null==s.USER.role?null:s.USER.role.canViewRoles)))},dependencies:[_.I,se,me],encapsulation:2})}}return r})(),canActivate:[u(3111).d],data:{href:"users",title:"USERS-ROLES",access:["can_view_users"]}}];let Ce=(()=>{class r{static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275mod=e.$C({type:r})}static{this.\u0275inj=e.G2t({imports:[g.m.forChild(Ue),g.m]})}}return r})();var be=u(3887),Ge=u(3268);let Te=(()=>{class r{static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275mod=e.$C({type:r})}static{this.\u0275inj=e.G2t({imports:[_.D,l.X1,Ce,be.G,Ge.o]})}}return r})()}}]);