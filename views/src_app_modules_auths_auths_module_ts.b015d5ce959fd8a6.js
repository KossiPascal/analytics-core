"use strict";(self.webpackChunkwebapp=self.webpackChunkwebapp||[]).push([["src_app_modules_auths_auths_module_ts"],{2642:(T,v,a)=>{a.r(v),a.d(v,{AuthsModule:()=>U});var h=a(4765),s=a(8832),d=a(6651),m=a(3308);const x=["promotion_reports","family_planning_reports","morbidity_reports","malaria_morbidity_reports","household_recaps_reports","pcime_newborn_reports","chws_reco_reports","reco_meg_situation_reports"],E=["reco_vaccine_not_done_dashboard","reco_vaccine_partial_done_dashboard","reco_vaccine_all_done_dashboard","reco_performance_dashboard","reco_full_year_performance_dashboard","active_reco_dashboard","reco_tasks_state_dashboard"];var t=a(6769),_=a(8394),P=a(4796),k=a(4224);function p(n,y){if(1&n&&(t.j41(0,"h6"),t.EFF(1),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.JRh(e.message)}}function R(n,y){1&n&&t.nrm(0,"span",21)}let u=(()=>{class n{constructor(e,r,o){this.cst=e,this.auth=r,this.indexdb=o,this.isLoading=!1,this.showPassword=!1,this.APP_LOGO=this.cst.APP_LOGO,this.COUNTRY_LOGO=this.cst.COUNTRY_LOGO,this.APP_NAME=this.cst.APP_TITLE}ngOnInit(){this.loginForm=this.createFormGroup()}createFormGroup(){return new s.gE({credential:new s.MJ("",[s.k0.required,s.k0.minLength(3)]),password:new s.MJ("",[s.k0.required,s.k0.minLength(8)])})}togglePasswordVisibility(){this.showPassword=!this.showPassword}login(){var e=this;this.isLoading=!0;const{credential:r,password:o}=this.loginForm.value;var i;this.auth.login({credential:r,password:o}).subscribe({next:(i=(0,m.A)(function*(c){const C=yield e.indexdb.getOne("user_info","username");if(!C||C.data!==r){const N=[...x,...E];for(const S of N)yield e.indexdb.deleteAllFromDB({dbName:S});yield e.indexdb.update({dbName:"user_info",newData:{id:"username",data:r}}).then(()=>{})}e.isLoading=!1,c.mustChangeDefaultPassword?location.href="auths/change-default-password":(console.log(c),location.href="reports")}),function(C){return i.apply(this,arguments)}),error:i=>{this.isLoading=!1,this.message=i?.message||"Erreur lors de la connexion"}})}static{this.\u0275fac=function(r){return new(r||n)(t.rXU(_.D),t.rXU(P.u),t.rXU(k.T))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-login"]],standalone:!1,decls:34,vars:10,consts:[[1,"login-body"],[1,"country-logo"],["alt","Country Logo",3,"src"],[1,"country-name"],[1,"country-subname"],[1,"login-form"],[1,"login-header"],["alt","App Logo",3,"src"],[1,"login-title"],["autocomplete","off","novalidate","",3,"ngSubmit","formGroup"],[4,"ngIf"],[1,"input-group"],[1,"input-group-icon"],[1,"fas","fa-user"],["type","text","id","username","formControlName","credential","placeholder","Username","autocomplete","off","autocorrect","off","spellcheck","false","autocapitalize","none","required",""],[1,"fas","fa-lock"],["id","password","formControlName","password","placeholder","Mot de passe","autocomplete","new-password","autocorrect","off","spellcheck","false","autocapitalize","none","required","",3,"type"],[3,"click"],["type","submit",1,"login-button",3,"disabled"],["class","fas fa-1x fa-sync-alt fa-spin",4,"ngIf"],["href","/documentations","target","_blank","rel","noopener noreferrer",1,"documentations"],[1,"fas","fa-1x","fa-sync-alt","fa-spin"]],template:function(r,o){1&r&&(t.j41(0,"div",0)(1,"div",1),t.nrm(2,"img",2),t.j41(3,"div")(4,"div",3),t.EFF(5,"TABLEAU DE BORD DE KENDEYA"),t.k0s(),t.j41(6,"div",4),t.EFF(7,"Bienvenue dans Kendeya Dashboards"),t.k0s()()(),t.j41(8,"div",5)(9,"div",6),t.nrm(10,"img",7),t.j41(11,"p",8),t.EFF(12,"Connexion"),t.k0s()(),t.j41(13,"form",9),t.bIt("ngSubmit",function(){return o.login()}),t.DNE(14,p,2,1,"h6",10),t.j41(15,"div",11)(16,"span",12),t.nrm(17,"i",13),t.k0s(),t.nrm(18,"input",14),t.k0s(),t.nrm(19,"br"),t.j41(20,"div",11)(21,"span",12),t.nrm(22,"i",15),t.k0s(),t.nrm(23,"input",16),t.j41(24,"i",17),t.bIt("click",function(){return o.togglePasswordVisibility()}),t.k0s()(),t.j41(25,"button",18),t.EFF(26," Se connecter "),t.DNE(27,R,1,0,"span",19),t.k0s(),t.nrm(28,"br")(29,"br")(30,"br")(31,"br"),t.j41(32,"a",20),t.EFF(33,"Documentations"),t.k0s()()()()),2&r&&(t.R7$(2),t.FS9("src",o.COUNTRY_LOGO,t.B4B),t.R7$(8),t.FS9("src",o.APP_LOGO,t.B4B),t.R7$(3),t.Y8G("formGroup",o.loginForm),t.R7$(),t.Y8G("ngIf",o.message),t.R7$(9),t.Y8G("type",o.showPassword?"text":"password"),t.R7$(),t.HbH(o.showPassword?"fas fa-eye":"fas fa-eye-slash"),t.R7$(),t.Y8G("disabled",!o.loginForm.valid||o.isLoading),t.R7$(2),t.Y8G("ngIf",o.isLoading))},dependencies:[h.I,s.qT,s.me,s.BC,s.cb,s.YS,s.j4,s.JD],styles:[".login-body[_ngcontent-%COMP%]{font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;background-color:#042;color:#fff;margin:0;padding:0;height:100vh;display:flex;justify-content:top;align-items:center;flex-direction:column;text-align:left!important}.documentations[_ngcontent-%COMP%]{text-decoration:none;color:#fff;border-radius:5px;padding:5px 10px;background-color:#727272;float:right}.country-logo[_ngcontent-%COMP%]{position:absolute;top:20px;left:20px;display:flex;align-items:center}.country-logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100px!important;min-height:80px;margin-right:10px}.country-name[_ngcontent-%COMP%]{font-size:20px;font-weight:700;color:#fff;width:230px}.country-subname[_ngcontent-%COMP%]{font-size:15px;font-weight:400;color:#fff;width:230px}.login-form[_ngcontent-%COMP%]{background-color:#042;border-radius:8px;color:#fff;margin:200px 30px 0;width:350px}.login-header[_ngcontent-%COMP%]{text-align:center}.login-header[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:120px;text-align:center}.login-title[_ngcontent-%COMP%]{font-size:18px;font-weight:600;margin-top:10px;margin-bottom:20px;color:#fff;text-align:center}.form-group[_ngcontent-%COMP%]{width:100%;margin-bottom:10px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:14px;font-weight:500;color:#042;margin-bottom:8px}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:12px;font-size:20px;border-radius:4px;background-color:#f2f2f2;color:#042;transition:border-color .3s ease,background-color .3s ease}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:#042;background-color:#fff;outline:none}.login-button[_ngcontent-%COMP%]{padding:12px;background-color:#063;color:#fff;font-size:16px;font-weight:700;border:none;border-radius:4px;cursor:pointer;transition:background-color .3s ease;margin-top:10px}.login-button[_ngcontent-%COMP%]:hover{background-color:#019149}input[_ngcontent-%COMP%]:-webkit-autofill{background-color:transparent!important;color:inherit!important}.fa-eye[_ngcontent-%COMP%], .fa-eye-slash[_ngcontent-%COMP%]{color:#000!important}@media (max-width: 600px){.login-title[_ngcontent-%COMP%]{font-size:24px;margin-bottom:20px}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .login-button[_ngcontent-%COMP%]{font-size:14px}.country-logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:30px;height:30px}}"]})}}return n})();var f=a(3366),l=a(2365),g=a(6167);function w(n,y){if(1&n&&(t.j41(0,"h6"),t.EFF(1),t.k0s()),2&n){const e=t.XpG();t.R7$(),t.JRh(e.message)}}function O(n,y){1&n&&(t.j41(0,"div",23),t.nrm(1,"br"),t.EFF(2," Les mots de passe ne concordent pas! "),t.k0s())}function b(n,y){1&n&&t.nrm(0,"span",24)}let M=(()=>{class n{constructor(e,r,o,i,c){this.cst=e,this.auth=r,this.api=o,this.snackbar=i,this.userCtx=c,this.showOlfPassword=!1,this.showPassword=!1,this.isLoading=!1,this.passwordMinLength=8,this.initApp()}initApp(){var e=this;return(0,m.A)(function*(){e.APP_LOGO=e.cst.APP_LOGO,e.COUNTRY_LOGO=e.cst.COUNTRY_LOGO,e.APP_NAME=e.cst.APP_TITLE,e.USER=yield e.userCtx.currentUser()})()}toggleOldPasswordVisibility(){this.showOlfPassword=!this.showOlfPassword}togglePasswordVisibility(){this.showPassword=!this.showPassword}ngOnInit(){this.passwordForm=this.createFormGroup()}createFormGroup(){return new s.gE({oldPassword:new s.MJ("",[s.k0.required]),newPassword:new s.MJ("",[s.k0.required,s.k0.minLength(this.passwordMinLength)]),confirmPassword:new s.MJ("",[s.k0.required,s.k0.minLength(this.passwordMinLength)])})}updatePassword(){if(this.isLoading=!0,this.passwordForm.valid){const{oldPassword:e,newPassword:r,confirmPassword:o}=this.passwordForm.value;if(r===o){const i=this.USER?.id;this.api.updatePassword({id:i,newPassword:r,oldPassword:e}).subscribe({next:c=>{200==c.status?(this.snackbar.show({msg:"Modifi\xe9 avec succ\xe8s, d\xe9connection imminante",color:"success",duration:3e3}),this.auth.logout()):this.snackbar.show({msg:c.data||"Erreur, pas de changement effectu\xe9",color:"danger",duration:5e3})},error:c=>{this.snackbar.show({msg:c||"Erreur, pas de changement effectu\xe9",color:"danger",duration:5e3})}})}else this.snackbar.show({msg:"Les mots de passe ne concordent pas",color:"danger",duration:5e3})}else this.snackbar.show({msg:"Les mots de passe sont invalident!",color:"danger",duration:5e3})}get passwordNotMatch(){const e=this.passwordForm.value.newPassword??"",r=this.passwordForm.value.confirmPassword??"",o=e.trim().length>this.passwordMinLength,i=r.trim().length>this.passwordMinLength;return o&&i&&e!==r}static{this.\u0275fac=function(r){return new(r||n)(t.rXU(_.D),t.rXU(P.u),t.rXU(f.G),t.rXU(l.z),t.rXU(g.i))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-change-default-password"]],standalone:!1,decls:51,vars:19,consts:[[1,"login-body"],[1,"country-logo"],["alt","Country Logo",3,"src"],[1,"country-name"],[1,"country-subname"],[1,"login-form"],[1,"login-header"],["alt","App Logo",3,"src"],[1,"login-title"],["autocomplete","off","novalidate","",3,"ngSubmit","formGroup"],[4,"ngIf"],[1,"form-group"],[1,"input-group"],[1,"input-group-icon"],[1,"fas","fa-lock"],["id","oldPassword","formControlName","oldPassword","placeholder","Mot de passe actuel","autocomplete","current-password","autocorrect","off","spellcheck","false","autocapitalize","none","required","",3,"type"],[3,"click"],["id","newPassword","formControlName","newPassword","placeholder","Nouveau mot de passe","autocomplete","new-password","autocorrect","off","spellcheck","false","autocapitalize","none","required","",3,"type"],[2,"color","gray","font-style","italic","margin-top","-20px"],["id","confirmPassword","formControlName","confirmPassword","placeholder","Confirmer ce mot de passe","autocomplete","new-password","autocorrect","off","spellcheck","false","autocapitalize","none","required","",3,"type"],["class","error",4,"ngIf"],["type","submit",1,"login-button",2,"float","right",3,"disabled"],["class","fas fa-1x fa-sync-alt fa-spin",4,"ngIf"],[1,"error"],[1,"fas","fa-1x","fa-sync-alt","fa-spin"]],template:function(r,o){1&r&&(t.j41(0,"div",0)(1,"div",1),t.nrm(2,"img",2),t.j41(3,"div")(4,"div",3),t.EFF(5,"TABLEAU DE BORD DE KENDEYA"),t.k0s(),t.j41(6,"div",4),t.EFF(7,"Bienvenue dans Kendeya Dashboards"),t.k0s()()(),t.j41(8,"div",5)(9,"div",6),t.nrm(10,"img",7),t.j41(11,"p",8),t.EFF(12,"Changement du mot de passe"),t.k0s()(),t.j41(13,"form",9),t.bIt("ngSubmit",function(){return o.updatePassword()}),t.DNE(14,w,2,1,"h6",10),t.nrm(15,"br"),t.j41(16,"label"),t.EFF(17,"Mot de passe actuelle:"),t.k0s(),t.j41(18,"div",11)(19,"div",12)(20,"span",13),t.nrm(21,"i",14),t.k0s(),t.nrm(22,"input",15),t.j41(23,"i",16),t.bIt("click",function(){return o.toggleOldPasswordVisibility()}),t.k0s()()(),t.nrm(24,"br"),t.j41(25,"label"),t.EFF(26,"Nouveau mot de passe:"),t.k0s(),t.j41(27,"div",11)(28,"div",12)(29,"span",13),t.nrm(30,"i",14),t.k0s(),t.nrm(31,"input",17),t.j41(32,"i",16),t.bIt("click",function(){return o.togglePasswordVisibility()}),t.k0s()(),t.j41(33,"span",18),t.EFF(34,"Minimum 8 caract\xe8res avec chiffres et symboles"),t.k0s()(),t.nrm(35,"br"),t.j41(36,"label"),t.EFF(37,"Confirmer le Nouveau mot de passe:"),t.k0s(),t.j41(38,"div",11)(39,"div",12)(40,"span",13),t.nrm(41,"i",14),t.k0s(),t.nrm(42,"input",19),t.j41(43,"i",16),t.bIt("click",function(){return o.togglePasswordVisibility()}),t.k0s()(),t.j41(44,"span",18),t.EFF(45,"Minimum 8 caract\xe8res avec chiffres et symboles"),t.k0s()(),t.DNE(46,O,3,0,"div",20),t.nrm(47,"br"),t.j41(48,"button",21),t.EFF(49," Changer mot de passe "),t.DNE(50,b,1,0,"span",22),t.k0s()()()()),2&r&&(t.R7$(2),t.FS9("src",o.COUNTRY_LOGO,t.B4B),t.R7$(8),t.FS9("src",o.APP_LOGO,t.B4B),t.R7$(3),t.Y8G("formGroup",o.passwordForm),t.R7$(),t.Y8G("ngIf",o.message),t.R7$(8),t.Y8G("type",o.showOlfPassword?"text":"password"),t.R7$(),t.HbH(o.showOlfPassword?"fas fa-eye":"fas fa-eye-slash"),t.R7$(8),t.Y8G("type",o.showPassword?"text":"password"),t.R7$(),t.HbH(o.showPassword?"fas fa-eye":"fas fa-eye-slash"),t.R7$(10),t.Y8G("type",o.showPassword?"text":"password"),t.R7$(),t.HbH(o.showPassword?"fas fa-eye":"fas fa-eye-slash"),t.R7$(3),t.Y8G("ngIf",o.passwordNotMatch),t.R7$(2),t.Y8G("disabled",!o.passwordForm.valid||o.isLoading),t.R7$(2),t.Y8G("ngIf",o.isLoading))},dependencies:[h.I,s.qT,s.me,s.BC,s.cb,s.YS,s.j4,s.JD],styles:[".login-body[_ngcontent-%COMP%]{font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;background-color:#042;color:#fff;margin:0;padding:0;height:100vh;display:flex;justify-content:top;align-items:center;flex-direction:column;text-align:left!important}.documentations[_ngcontent-%COMP%]{text-decoration:none;color:#fff;border-radius:5px;padding:5px 10px;background-color:#727272;float:right}.country-logo[_ngcontent-%COMP%]{position:absolute;top:20px;left:20px;display:flex;align-items:center}.country-logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100px!important;min-height:80px;margin-right:10px}.country-name[_ngcontent-%COMP%]{font-size:20px;font-weight:700;color:#fff;width:230px}.country-subname[_ngcontent-%COMP%]{font-size:15px;font-weight:400;color:#fff;width:230px}.login-form[_ngcontent-%COMP%]{background-color:#042;border-radius:8px;color:#fff;margin:200px 30px 0;width:350px}.login-header[_ngcontent-%COMP%]{text-align:center}.login-header[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:120px;text-align:center}.login-title[_ngcontent-%COMP%]{font-size:18px;font-weight:600;margin-top:10px;margin-bottom:20px;color:#fff;text-align:center}.form-group[_ngcontent-%COMP%]{width:100%;margin-bottom:10px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:14px;font-weight:500;color:#042;margin-bottom:8px}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:12px;font-size:20px;border-radius:4px;background-color:#f2f2f2;color:#042;transition:border-color .3s ease,background-color .3s ease}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border-color:#042;background-color:#fff;outline:none}.login-button[_ngcontent-%COMP%]{padding:12px;background-color:#063;color:#fff;font-size:16px;font-weight:700;border:none;border-radius:4px;cursor:pointer;transition:background-color .3s ease;margin-top:10px}.login-button[_ngcontent-%COMP%]:hover{background-color:#019149}input[_ngcontent-%COMP%]:-webkit-autofill{background-color:transparent!important;color:inherit!important}.fa-eye[_ngcontent-%COMP%], .fa-eye-slash[_ngcontent-%COMP%]{color:#000!important}.error[_ngcontent-%COMP%]{color:red;font-size:.85rem}@media (max-width: 600px){.login-title[_ngcontent-%COMP%]{font-size:24px;margin-bottom:20px}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .login-button[_ngcontent-%COMP%]{font-size:14px}.country-logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:30px;height:30px}}"]})}}return n})();var F=a(6104),L=a(6098),D=a(8175);const j=[{path:"",redirectTo:"login",pathMatch:"full"},{path:"login",component:u,canActivate:[(()=>{class n{constructor(e,r,o,i,c){this.userCtx=e,this.constants=r,this.titleService=o,this.router=i,this.auth=c,this.destroy$=new F.B,this.publicAccessPages=["auths/lock-screen","auths/login","auths/forgot-password"]}canActivate(e,r){var o=this;return(0,m.A)(function*(){const i=yield o.userCtx.isLoggedIn(),c=r.url.slice(1);return o.titleService.setTitle(e.data?.title||o.constants.APP_TITLE),i?(yield o.auth.goToDefaultPage(),!1):!!o.publicAccessPages.includes(c)||(yield o.auth.goToDefaultPage(),!1)})()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static{this.\u0275fac=function(r){return new(r||n)(t.KVO(g.i),t.KVO(_.D),t.KVO(L.hE),t.KVO(D.t),t.KVO(P.u))}}static{this.\u0275prov=t.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})()],data:{href:"auths/login",title:"User login",access:["_public"]}},{path:"change-default-password",component:M,canActivate:[a(3111).d],data:{href:"auths/change-default-password",title:"Change Default Password",access:["must_change_default_password"]}}];let B=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=t.$C({type:n})}static{this.\u0275inj=t.G2t({imports:[d.m.forChild(j),d.m]})}}return n})(),U=(()=>{class n{static{this.\u0275fac=function(r){return new(r||n)}}static{this.\u0275mod=t.$C({type:n})}static{this.\u0275inj=t.G2t({imports:[h.D,s.X1,B]})}}return n})()},3111:(T,v,a)=>{a.d(v,{d:()=>k});var h=a(3308),s=a(6104),d=a(6769),m=a(6098),x=a(8394),E=a(8175),A=a(6167),t=a(4796),_=a(4224),P=a(960);let k=(()=>{class p{constructor(u,f,l,g,w,O,b){this.titleService=u,this.constants=f,this.router=l,this.userContext=g,this.auth=w,this.indexdb=O,this.error=b,this.destroy$=new s.B}canActivate(u,f){var l=this;return(0,h.A)(function*(){const g=yield l.userContext.currentUser();if(!l.userContext.isLoggedIn()||!g)return l.auth.logout(),!1;const w=u.data?.href;if(g.mustChangeDefaultPassword&&!g.hasChangedDefaultPassword&&"auths/change-default-password"!=w)return location.href="auths/change-default-password",!1;const O=u.data?.access??[],b=u.data?.title||l.constants.APP_TITLE,M=new Set;for(const L of g.routes??[])for(const D of L.authorizations??[])M.add(D);return!0===g.role?.isSuperUser||l.hasAnyMatch(M,O)?(l.titleService.setTitle(b),!0):(l.error.navigateTo("401"),!1)})()}hasAnyMatch(u,f){return f.some(l=>u.has(l))}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static{this.\u0275fac=function(f){return new(f||p)(d.KVO(m.hE),d.KVO(x.D),d.KVO(E.t),d.KVO(A.i),d.KVO(t.u),d.KVO(_.T),d.KVO(P.Z))}}static{this.\u0275prov=d.jDH({token:p,factory:p.\u0275fac,providedIn:"root"})}}return p})()}}]);